////
//// Some unit testing for bbop-mmm-requests.js
////
//// Usage:
////  rhino -modules static/bbop.js -opt -1 -f js/bbop-mmm-requests.js -f js/bbop-mmm-requests.js.tests -f -

////

// Load bbop.
var bbop = require('bbop').bbop;
var mr_t = new bbop.test();

///
/// Start unit testing.
///

var sok = mr_t.is_same_atom;

// 
(function(){

     var reqs = new bbop_mmm_request_set('foo', 'information');
     var req = new bbop_mmm_request('model', 'get');
     req.model_id('123');
     reqs.add(req);
     var args = reqs.callable();
     
     sok(args.uid, 'foo', 'foo uid');
     sok(args.intention, 'information', 'information intent');
     
     var blob = args.requests;
     var deblob = decodeURIComponent(blob);
     var jsblob = bbop.json.parse(deblob);
     sok(jsblob.length, 1, 'one request');
     sok(jsblob[0].entity, 'model', 'model entity');
     sok(jsblob[0].operation, 'get', 'get model');
     sok(jsblob[0].arguments.modelId, '123', 'model 123');

 })();

///
/// End unit testing.
///

// Final report.
mr_t.report();
