{{=<% %>=}}

<nav id="navbar" class="navbar navbar-inverse navbar-static-top">
  <div class="container-fluid">

    <!-- Button on collapse. -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a
        href="<%noctua_landing%>"
        class="navbar-brand branding-logo-<%noctua_context%>">
        &nbsp;
      </a>
    </div>

    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="navbar-tab active">
          <a
        <%#barista_token%>
            href="/?barista_token=<%barista_token%>"
        <%/barista_token%>
        <%^barista_token%>
            href="/"
        <%/barista_token%>
            class="branding-<%noctua_context%>">
            <%noctua_branding%>
          </a>
        </li>

        <!-- Help. -->
        <li id="about_trigger" class="navbar-tab">
          <a
            href="<%noctua_landing%>#about">
              About
          </a>
        </li>
      </ul>

      <div class="nav navbar-right">
        <%^barista_token%>
        <!-- Login. -->
        <a id="action_barista_login" class="btn btn-default navbar-btn" href="<%barista_login%>" title="">Login</a>
        <%/barista_token%>
        <%#barista_token%>
        <!-- Logout. -->
        <span class="user_name_info">
          <span id="user_name_info">
          </span>
          &nbsp;&nbsp;
        </span>
        <a id="action_barista_logout" class="btn btn-default navbar-btn" href="<%barista_logout%>" title="">Logout</a>
        <%/barista_token%>
        &nbsp;&nbsp;
      </div>

    </div>
  </div>
</nav>

<div id="noctua-app" class="container" ng-app="noctuaBasicApp" ng-strict-di>
  <div ng-controller="NoctuaBasicController as basic" ng-init="basic.init()">

    <div ng-hide="basic.response_model">
      <br>
      <hr>
      <h1 class="text-center">Loading Model...</h1>
      <hr>
    </div>

    <div ng-hide="!basic.response_model">
      <div class="row well well-sm">
        <div
          ng-hide="!basic.editingTitle"
          class="col-xs-8">
          <input
            autofocus
            ng-model="basic.newTitle"
            type="text"
            class="form-control"
            id="modelTitle"
            placeholder="Title your model">
        </div>
        <div
          ng-hide="!basic.editingTitle"
          class="col-xs-2">
          <button
            type="button"
            class="btn btn-warning btn-sm"
            ng-disabled="!(basic.modelTitle && basic.modelTitle.length > 0)"
            ng-click="basic.cancelEditTitle()">
            Cancel
          </button>
        </div>
        <div
          ng-hide="!basic.editingTitle"
          class="col-xs-2">
          <button
            ng-disabled="!(basic.newTitle && basic.newTitle.length > 0)"
            type="button" class="btn btn-success btn-sm" ng-click="basic.saveEditedTitle()">
            Set Title
          </button>
        </div>
        <div
          ng-hide="basic.editingTitle"
          class="col-xs-8">
          <h4>
            {{basic.modelTitle}}
          </h4>
        </div>

        <%#barista_token%>
        <div
          ng-hide="basic.editingTitle"
          class="col-xs-1">
          &nbsp;
        </div>
        <div
          ng-hide="basic.editingTitle"
          class="col-xs-2">
          <button
            type="button" class="btn btn-primary btn-sm" ng-click="basic.editTitle()">
            Change Title
          </button>
        </div>
        <%/barista_token%>
      </div>

      <div
        class="row well well-sm">
      <%#barista_token%>
        <div class="col-xs-3">
          <button
            ng-disabled="!basic.isValidModel()"
            id="save_button"
            type="button"
            class="btn btn-success btn-sm"
            ng-click="basic.store()">
            Save Model
          </button>
        </div>
        <div class="col-xs-3">
          <button ng-disabled="true" id="delete_button" type="button" class="btn btn-warning btn-sm" ng-click="basic.delete()">
            <s>Delete Model</s>
          </button>
        </div>
      <%/barista_token%>
        <div class="col-xs-3">
          <a
            type="button" class="btn btn-primary btn-sm"
            href="{{basic.edit_graph_url}}">
            View Graph
          </a>
        </div>
        <div class="col-xs-3">
          <a
            type="button" class="btn btn-primary btn-sm"
            href="{{basic.export_owl_url}}"
            target="_blank">
            Export OWL
          </a>
        </div>
      </div>


      <div class="row">
        <h5 class="text-center">Annotations</h5>
      </div>

      <div
        class="row">

        <div
          ng-class="basic.editing_row === entry ? 'association-entry-editing' : 'association-entry'"
          ng-repeat="entry in basic.grid_model track by $index">
          <table
            class="table association-table">

            <tbody>
              <tr>
                <th colspan="2">Disease</th>
                <td
                  ng-hide="basic.editing_row !== entry"
                  colspan="10">
                  <select
                    class="form-control"
                    id="select_disease_{{$index}}"
                    placeholder="Pick a Disease...">
                  </select>
                </td>
                <td
                  ng-hide="basic.editing_row === entry"
                  colspan="10">
                  <a
                    target="_blank"
                    href="http://monarchinitiative.org/resolve/{{entry.disease_id}}">
                      {{entry.disease}}
                  </a>
                </td>
              </tr>
              <tr>
                <th colspan="2">Phenotype</th>
                <td
                  ng-hide="basic.editing_row !== entry"
                  colspan="10">
                  <select
                    class="form-control"
                    id="select_phenotype_{{$index}}"
                    placeholder="Pick a Phenotype...">
                  </select>
                </td>
                <td
                  ng-hide="basic.editing_row === entry"
                  colspan="10">
                  <a
                    target="_blank"
                    href="http://monarchinitiative.org/resolve/{{entry.phenotype_id}}">
                      {{entry.phenotype}}
                  </a>
                </td>
              </tr>
              <tr>
                <th colspan="2">Age of Onset</th>
                <td
                  ng-hide="basic.editing_row !== entry"
                  colspan="10">
                  <select
                    class="form-control"
                    id="select_ageofonset_{{$index}}"
                    placeholder="Pick an Age of Onset...">
                  </select>
                </td>
                <td
                  ng-hide="basic.editing_row === entry"
                  colspan="10">
                  <a
                    target="_blank"
                    href="http://monarchinitiative.org/resolve/{{entry.ageofonset_id}}">
                      {{entry.ageofonset}}
                  </a>
                </td>
              </tr>
              <tr>
                <th colspan="2">Description</th>
                <td
                  ng-hide="basic.editing_row !== entry"
                  colspan="10">
                  <textarea
                    class="form-control" rows="2" ng-model="basic.selected_description"></textarea>
                </td>

                <td
                  ng-hide="basic.editing_row === entry"
                  colspan="10">
                  {{entry.description}}
                </td>
              </tr>
              <tr
                ng-class="basic.editing_row === entry ? 'evidence-row-editing' : 'evidence-row'"
                ng-repeat="ev_ref in entry.evidence_metadata track by $index">
                <th colspan="2">
                Evidence
                </th>

                <td
                  ng-hide="basic.editing_row !== entry"
                  colspan="9">

                  <div class="row">
                    <div class="col-xs-12">
                      <select class="form-control" id="{{ev_ref.htmlid}}_{{$parent.$index}}_{{$index}}" placeholder="Select evidence..." ng-model="ev_ref.ev"></select>
                    </div>
                  </div>
                  <div class="row" style="margin:3px -35px 0 -35px;padding:0;">
                    <div class="col-xs-12">
                      <div
                        class="form-horizontal"
                        ng-repeat="ref in ev_ref.ref_list">
                        <div
                          class="xform-group">
                          <label
                            class="col-xs-2 control-label"
                            style="font-size:0.8em;font-weight:400;color:#555;margin:0;padding:0;"
                            for="{{ev_ref.htmlid + ref.htmlid}}_{{$parent.$index}}_{{$index}}">
                            Reference
                          </label>
                          <div
                            class="col-xs-9">
                            <input
                              type="text"
                              class="form-control"
                              id="{{ev_ref.htmlid + ref.htmlid}}_{{$parent.$index}}_{{$index}}"
                              placeholder="Enter supporting reference (e.g., PMID:1234)"
                              ng-model="ref.ref">
                            </input>
                          </div>
                          <div class="col-xs-1">
                            <button
                              type="submit"
                              ng-hide="!$first"
                              class="btn btn-secondary btn-xs"
                              style="margin:0 0 0 -15px;xpadding:0;"
                              ng-click="basic.add_ref(ev_ref)">
                              <i class="glyphicon glyphicon-plus"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </td>
                <th
                  ng-hide="basic.editing_row !== entry"
                  colspan="1">
                  <button
                    ng-hide="!$first"
                    class="btn btn-secondary btn-xs"
                    ng-click="basic.add_ev(basic.selected_ev_ref_list, $parent.$index)">
                    <i class="glyphicon glyphicon-plus"></i>
                  </button>
                </th>
                <td
                  ng-hide="basic.editing_row === entry"
                  colspan="10">
                  <a
                    target="_blank"
                    href="http://purl.obolibrary.org/obo/{{basic.convertECOId(ev_ref.id)}}">
                    {{ev_ref.label}}
                  </a>

                  <div
                    ng-repeat="ref in ev_ref.ref_list">
                    &nbsp;&nbsp;&nbsp;&nbsp;{{ref.ref}}
                  </div>
                </td>
              </tr>

        <%#barista_token%>
              <tr
                ng-hide="basic.editing_row === entry"
                class="action-row">
                <td colspan="2">
                  &nbsp;
                </td>
                <td colspan="3">
                  <button type="button" class="btn btn-block btn-primary btn-xs"
                    ng-disabled="basic.editing_row"
                    ng-click="basic.editRow(entry, $index, false)">Edit</button>
                </td>
                <td colspan="3" >
                  <button
                    ng-disabled="basic.editing_row"
                    type="button" class="btn btn-block btn-primary btn-xs" ng-click="basic.duplicateRow(entry, $index)">Duplicate</button>
                </td>
                <td colspan="3" >
                  <button
                    type="button"
                    ng-disabled="basic.editing_row"
                    class="btn btn-block btn-warning btn-xs"
                    ng-click="basic.deleteRow(entry.disease_node_id, entry.phenotype_node_id, entry.ageofonset_node_id)">Delete</button>
                </td>
                <td colspan="1">
                  &nbsp;
                </td>
              </tr>

              <tr
                ng-hide="basic.editing_row !== entry"
                class="action-row">
                <td colspan="2">

                </td>

                <td colspan="3">
                  <button type="button" class="btn btn-block btn-success btn-xs"
                    ng-disabled="!basic.isValidAssociation()"
                    ng-click="basic.saveEditedRow()">Save</button>
                </td>
                <td colspan="2">
                  &nbsp;
                </td>
                <td colspan="3" >
                  <button type="button" class="btn btn-block btn-warning btn-xs"
                    ng-click="basic.cancelEditRow($index)">Cancel</button>
                </td>
                <td colspan="2">
                  &nbsp;
                </td>
              </tr>
        <%/barista_token%>

            </tbody>
          </table>


        </div>

        <div style="margin:10px;">
          <%#barista_token%>
          <button
            ng-disabled="basic.editing_row"
            type="button"
            class="btn btn-primary btn-sm btn-block"
            ng-click="basic.addRow()">
            Add New Annotation
          </button>
          <%/barista_token%>
        </div>
    </div> <!-- ng-hide -->
  </div>
</div>
